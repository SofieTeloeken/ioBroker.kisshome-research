"use strict";(self.webpackChunkiobroker_admin_component_telegram=self.webpackChunkiobroker_admin_component_telegram||[]).push([["src_ConfigCustomInstancesSelector_jsx"],{57460:(Q,I,_)=>{_.d(I,{A:()=>X});var M=_(28437),o=_.n(M),$=_(95973),b=_.n($),c=_(67085),Y=_.n(c),O=_(21839),Z=_.n(O),f=_(60556),ee=_.n(f),E=_(37449),te=_.n(E),j=Object.defineProperty,W=Object.defineProperties,U=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,x=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,G=Reflect.get,P=(s,e,r)=>e in s?j(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,L=(s,e)=>{for(var r in e||(e={}))V.call(e,r)&&P(s,r,e[r]);if(A)for(var r of A(e))B.call(e,r)&&P(s,r,e[r]);return s},K=(s,e)=>W(s,U(e)),F=(s,e,r)=>G(x(s),r,e),C=(s,e,r)=>new Promise((p,u)=>{var a=t=>{try{l(r.next(t))}catch(i){u(i)}},n=t=>{try{l(r.throw(t))}catch(i){u(i)}},l=t=>t.done?p(t.value):Promise.resolve(t.value).then(a,n);l((r=r.apply(s,e)).next())});const m={table:{minWidth:400},header:{fontSize:16,fontWeight:"bold"},td:{padding:"2px 16px"}};function S(s,e){return C(this,null,function*(){const r=yield s.getObjectViewSystem("state",`${e}.`,`${e}.\u9999`),p=[],u=Object.keys(r).filter(a=>a.endsWith(".address"));for(let a=0;a<u.length;a++){const n=u[a],l=yield s.getState(n);l!=null&&l.val&&p.push({ip:l.val,name:"homekit-controller"})}return p})}function w(s,e){return C(this,null,function*(){const r=yield s.getObjectViewSystem("state",`${e}.`,`${e}.\u9999`),p=[],u=Object.keys(r).filter(a=>a.endsWith(".hostname"));for(let a=0;a<u.length;a++){const n=u[a],l=yield s.getState(n);l!=null&&l.val&&p.push({ip:l.val,name:"shelly"})}return p})}function z(s,e){return C(this,null,function*(){var r,p;const u=yield s.getObjectViewSystem("state",`${e}.info.clients.`,`${e}.info.clients.\u9999`),a=[],n=Object.values(u);for(let l=0;l<n.length;l++)(p=(r=n[l])==null?void 0:r.native)!=null&&p.ip&&a.push({ip:n[l].native.ip,name:e.split(".")[0]});return a})}function q(s,e){return C(this,null,function*(){var r,p,u;const a=yield s.getObjectViewSystem("device",`${e}.`,`${e}.\u9999`),n=Object.values(a),l=[];for(let t=0;t<n.length;t++)((r=n[t])==null?void 0:r.type)==="device"&&((u=(p=n[t])==null?void 0:p.native)!=null&&u.ip)&&l.push({ip:n[t].native.ip,name:e.split(".")[0]});return l})}const H=[{adapter:"broadlink2",attr:"additional"},{adapter:"harmony",attr:"devices",arrayAttr:"ip"},{adapter:"hm-rpc",attr:"homematicAddress"},{adapter:"homeconnect"},{adapter:"homekit-controller",attr:"discoverIp",browse:S},{adapter:"hue",attr:"bridge"},{adapter:"knx",attr:"bind"},{adapter:"lgtv",attr:"ip"},{adapter:"loxone",attr:"host"},{adapter:"mihome-vacuum",attr:"ip"},{adapter:"modbus",attr:"params.bind",clients:!0},{adapter:"mqtt",attr:"url",clients:!0},{adapter:"mqtt-client",attr:"host"},{adapter:"lcn",attr:"host"},{adapter:"knx",attr:"gwip"},{adapter:"onvif"},{adapter:"openknx",attr:"gwip"},{adapter:"broadlink2",attr:"additional"},{adapter:"proxmox",attr:"ip"},{adapter:"samsung",attr:"ip"},{adapter:"shelly",browse:w},{adapter:"sonoff",clients:!0},{adapter:"sonos",attr:"devices",arrayAttr:"ip"},{adapter:"tr-064",attr:"iporhost"},{adapter:"unify",attr:"controllerIp"},{adapter:"upnp",browse:q},{adapter:"wled",attr:"devices",arrayAttr:"ip"},{adapter:"wifilight",attr:"devices",arrayAttr:"ip"}];function k(s){return s?typeof s!="string"?!1:(s=s.trim().toUpperCase().replace(/\s/g,""),!s||s.match(/^([0-9A-F]{2}[:-]){5}([0-9A-F]{2})$/)?!0:!!s.match(/^([0-9A-F]{12})$/)):!0}function R(s){return k(s)?(s=s.toUpperCase().trim().replace(/[\s:-]/g,""),s.replace(/(..)(..)(..)(..)(..)(..)/,"$1:$2:$3:$4:$5:$6")):s}function D(s){return s?typeof s!="string"?!1:(s=s.trim(),s?s.match(/^\d+\.\d+\.\d+\.\d+$/)?!s.trim().split(".").map(r=>parseInt(r,10)).find(r=>r<0||r>255):!1:!0):!0}function N(s){return D(s)?s.trim().split(".").map(r=>parseInt(r,10)).join("."):s}class g extends f.ConfigGeneric{componentDidMount(){return C(this,null,function*(){F(g.prototype,this,"componentDidMount").call(this);let e=[];const r=yield this.props.socket.getObject(`system.adapter.kisshome-research.${this.props.instance}`);r!=null&&r.common.host&&(e=(yield this.props.socket.getObject(`system.host.${r.common.host}`)).common.address);let p=yield this.props.socket.getAdapterInstances();p=p.filter(n=>{var l;return((l=n==null?void 0:n.common)==null?void 0:l.adminUI)&&(n.common.adminUI.config!=="none"||n.common.adminUI.tab)}).map(n=>({id:n._id.replace(/^system\.adapter\./,""),name:n.common.name,native:n.native})).sort((n,l)=>n.id>l.id?1:n.id<l.id?-1:0);const u=yield this.collectIpAddresses(p,e),a={instances:p,ips:u};if(this.props.alive){const n=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];a.runningRequest=!0,this.props.socket.sendTo(`kisshome-research.${this.props.instance}`,"getMacForIps",n).then(l=>{var t;let i=!1;const h={};(t=l==null?void 0:l.result)==null||t.forEach(d=>{const v=d.ip,T=u.findIndex(J=>J.ip===v);T!==-1&&(i=!0,u[T].mac=d.mac,h[d.mac]=d.vendor)});let y=!1;n.forEach(d=>{const v=u.findIndex(T=>T.ip===d.ip);v!==-1&&(d.mac!==u[v].mac&&(y=!0),h[d.mac]||(h[d.mac]=u[v].vendor,i=!0))}),i?this.setState({ips:u,vendors:h,runningRequest:!1}):this.setState({runningRequest:!1}),y&&this.onChange("devices",n)}).catch(l=>{l.toString()!=="no results"&&window.alert(`Cannot get MAC addresses: ${l}`),this.setState({runningRequest:!1})})}this.setState(a)})}static getAttr(e,r){if(Array.isArray(r)){const p=r.shift();return typeof e[p]=="object"?g.getAttr(e[p],r):r.length?null:e[p]}return g.getAttr(e,r.split("."))}static isIp(e){if(typeof e=="string"){if(e.match(/^\d+\.\d+\.\d+\.\d+$/))return"ipv4";if(e.match(/^[\da-fA-F:]+$/))return"ipv6"}return null}componentWillUnmount(){super.componentWillUnmount(),this.validateTimeout&&clearTimeout(this.validateTimeout),this.validateTimeout=null}validateAddresses(){this.validateTimeout&&clearTimeout(this.validateTimeout),this.validateTimeout=setTimeout(()=>{this.validateTimeout=null},1e3)}collectIpAddresses(e,r){return C(this,null,function*(){let p=[];e=e||this.state.instances;for(let a=0;a<e.length;a++){const n=H.find(l=>l.adapter===e[a].name);if(n&&e[a].native){const l=n.attr;if(n.attr&&e[a].native[l])if(n.arrayAttr){if(Array.isArray(e[a].native[l]))for(let t=0;t<e[a].native[l].length;t++){const i=e[a].native[l][t],h=g.getAttr(i,n.arrayAttr),y=g.isIp(h);y&&p.push({ip:h,type:y,desc:e[a].name})}}else{const t=g.getAttr(e[a].native,l),i=g.isIp(t);i&&p.push({ip:t,type:i,desc:e[a].name})}if(n.browse)try{(yield n.browse(this.props.socket,e[a]._id.replace("system.adapter.",""))).forEach(i=>{const h=g.isIp(i.ip);h&&p.push({ip:i.ip,type:h,desc:i.name||e[a].name})})}catch(t){console.error(`Cannot collect "${e[a]}": ${t}`)}if(n.clients)try{(yield z(this.props.socket,e[a]._id.replace("system.adapter.",""))).forEach(i=>{const h=g.isIp(i.ip);h&&p.push({ip:i.ip,type:h,desc:i.name||e[a].name})})}catch(t){console.error(`Cannot collect "${e[a]}": ${t}`)}}else e[a].native.ip&&typeof e[a].native.ip=="string"&&e[a].native.ip.match(/^\d+\.\d+\.\d+\.\d+$/)?p.push({ip:e[a].native.ip,type:"ipv4",desc:e[a].name}):e[a].native.host&&typeof e[a].native.host=="string"&&e[a].native.host.match(/^\d+\.\d+\.\d+\.\d+$/)&&p.push({ip:e[a].native.host,type:"ipv4",desc:e[a].name})}p=p.filter(a=>!r.includes(a.ip)&&a.ip!=="0.0.0.0"&&a.ip!=="localhost"&&a.ip!=="127.0.0.1"&&a.ip!=="::1"&&a.type==="ipv4");const u=[];for(let a=0;a<p.length;a++)u.find(n=>n.ip===p[a].ip)||u.push(p[a]);return u})}renderItem(e,r,p){var u;const a=f.ConfigGeneric.getValue(this.props.data,"devices")||[],n=this.state.ips?a.filter(t=>!this.state.ips.find(i=>i.ip===t.ip)):a,l=a.every(t=>t.enabled)&&(this.state.ips?this.state.ips.every(t=>a.find(i=>i.ip===t.ip)):!0);return o().createElement(c.TableContainer,null,this.state.runningRequest?o().createElement(c.LinearProgress,null):o().createElement("div",{style:{height:2,width:"100%"}}),o().createElement(c.Table,{style:m.table,size:"small"},o().createElement(c.TableHead,null,o().createElement(c.TableRow,null,o().createElement(c.TableCell,{style:K(L({},m.header),{width:120})},o().createElement(c.Checkbox,{title:l?E.i18n.t("custom_kisshome_unselect_all"):E.i18n.t("custom_kisshome_select_all"),checked:l,indeterminate:!l&&a.length>0,disabled:this.state.runningRequest,onClick:()=>{const t=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];if(l){t.forEach(i=>i.enabled=!1);for(let i=t.length-1;i>=0;i--)this.state.ips.find(h=>h.ip===t[i].ip)&&t.splice(i,1)}else t.forEach(i=>i.enabled=!0),this.state.ips.forEach(i=>{t.find(h=>i.ip===h.ip)||t.push({ip:i.ip,mac:i.mac,desc:i.desc,enabled:!0})}),t.forEach(i=>i.enabled=!0);this.onChange("devices",t)}}),o().createElement(c.Fab,{onClick:()=>{const t=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];t.push({ip:"0.0.0.0",mac:"",desc:"",enabled:!0}),this.onChange("devices",t)},size:"small",disabled:this.state.runningRequest},o().createElement(O.Add,null))),o().createElement(c.TableCell,{style:m.header},E.i18n.t("custom_kisshome_ip")),o().createElement(c.TableCell,{style:m.header},E.i18n.t("custom_kisshome_mac")),o().createElement(c.TableCell,{style:m.header},E.i18n.t("custom_kisshome_vendor")),o().createElement(c.TableCell,{style:m.header},E.i18n.t("custom_kisshome_name")),o().createElement(c.TableCell,{style:m.header}))),o().createElement(c.TableBody,null,(u=this.state.ips)==null?void 0:u.map((t,i)=>{var h,y;return o().createElement(c.TableRow,{key:i},o().createElement(c.TableCell,{scope:"row",style:m.td},o().createElement(c.Checkbox,{checked:!!((h=a.find(d=>d.ip===t.ip))!=null&&h.enabled),disabled:this.state.runningRequest,onClick:()=>{const d=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]],v=d.findIndex(T=>T.ip===t.ip);v===-1?d.push({ip:t.ip,mac:t.mac,desc:t.desc,enabled:!0}):d.splice(v,1),this.onChange("devices",d)}})),o().createElement(c.TableCell,{style:m.td},t.ip),o().createElement(c.TableCell,{style:m.td},t.mac||""),o().createElement(c.TableCell,{style:m.td},((y=this.state.vendors)==null?void 0:y[t.mac])||""),o().createElement(c.TableCell,{style:m.td},t.desc),o().createElement(c.TableCell,{style:m.td}))}),n.map((t,i)=>{var h,y;return o().createElement(c.TableRow,{key:i},o().createElement(c.TableCell,{scope:"row",style:m.td},o().createElement(c.Checkbox,{checked:!!((h=a.find(d=>d.ip===t.ip))!=null&&h.enabled),disabled:this.state.runningRequest,onClick:()=>{const d=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];d[i].enabled=!d[i].enabled,this.onChange("devices",d)}})),o().createElement(c.TableCell,{style:m.td},o().createElement(c.TextField,{fullWidth:!0,error:!D(t.ip),value:t.ip,disabled:this.state.runningRequest,onChange:d=>{const v=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];v[i].ip=d.target.value,this.onChange("devices",v),this.validateAddresses()},onBlur:()=>{if(t.ip.trim()){const d=N(t.ip);if(d!==t.ip){const v=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];v[i].ip=d,this.onChange("devices",v)}}},variant:"standard"})),o().createElement(c.TableCell,{style:m.td},o().createElement(c.TextField,{fullWidth:!0,value:t.mac,disabled:this.state.runningRequest,error:!k(t.mac),onChange:d=>{const v=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];v[i].mac=d.target.value,this.onChange("devices",v),this.validateAddresses()},onBlur:()=>{if(t.mac.trim()){const d=R(t.mac);if(d!==t.mac){const v=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];v[i].mac=d,this.onChange("devices",v)}}},variant:"standard"})),o().createElement(c.TableCell,{style:m.td},((y=this.state.vendors)==null?void 0:y[R(t.mac)])||""),o().createElement(c.TableCell,{style:m.td},o().createElement(c.TextField,{fullWidth:!0,value:t.desc,disabled:this.state.runningRequest,onChange:d=>{const v=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];v[i].desc=d.target.value,this.onChange("devices",v)},variant:"standard"})),o().createElement(c.TableCell,{style:m.td},o().createElement(c.IconButton,{disabled:this.state.runningRequest,onClick:()=>{const d=[...f.ConfigGeneric.getValue(this.props.data,"devices")||[]];d.splice(i,1),this.onChange("devices",d)}},o().createElement(O.Delete,null))))}))))}}g.propTypes={socket:b().object.isRequired,themeType:b().string,themeName:b().string,style:b().object,data:b().object.isRequired,schema:b().object,onError:b().func,onChange:b().func};const X=g}}]);

//# sourceMappingURL=src_ConfigCustomInstancesSelector_jsx.808bd325.chunk.js.map